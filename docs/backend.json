{
  "entities": {
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction, either an income or an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "type": {
          "type": "string",
          "description": "Type of transaction: 'expense' or 'income'.",
          "format": "string"
        },
        "description": {
          "type": "string",
          "description": "Description of the transaction."
        },
        "category": {
          "type": "string",
          "description": "Category of the transaction (e.g., 'Mercado/Insumos', 'Venda de Bolo')."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "discount": {
          "type": "number",
          "description": "Discount amount applied to the transaction."
        },
        "deliveryFee": {
          "type": "number",
          "description": "Delivery fee applied to the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the transaction occurred.",
          "format": "date-time"
        },
        "dateMs": {
          "type": "number",
          "description": "Timestamp in milliseconds for easier filtering and sorting."
        }
      },
      "required": [
        "id",
        "type",
        "description",
        "category",
        "amount",
        "userId",
        "timestamp",
        "dateMs"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SweetBalance application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        }
      },
      "required": [
        "id"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product that can be sold.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this product."
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "artifacts/{appId}/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores individual transaction data for each user. The userId parameter ensures that each user's transactions are kept separate and secure.",
          "params": [
            {
              "name": "appId",
              "description": "The unique identifier of the SweetBalance application."
            },
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the transaction."
            }
          ]
        }
      },
      {
        "path": "artifacts/{appId}/users/{userId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product data for each user.",
          "params": [
            {
              "name": "appId",
              "description": "The unique identifier of the SweetBalance application."
            },
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data isolation and efficient querying for the SweetBalance application. Each user's transactions and products are stored in a dedicated subcollection under their user ID, enhancing data privacy and security.  The root `artifacts/{appId}` allows logical separation of app data. Transactions and products are secured via path-based rules, ensuring only the authenticated user can access their own data.  Authorization Independence is achieved as there is no dependency on any parent document and ownership is determined by the path. This provides security and allows atomic batch operations.\n\nThis structure supports the required QAPs (Rules are not Filters) because the listing operation only returns the items under the user's path and is secured by the user id."
  }
}
